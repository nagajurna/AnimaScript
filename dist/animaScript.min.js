"use strict";function AnimaText(a,b){if(void 0===a)throw new TypeError("Invalid AnimaText() argument : element must be defined");if(!a.tagName)throw new TypeError("Invalid AnimaText() argument : element must be HTML element");this.element=a,void 0!==b?(void 0===b.unit?this.unit="c":this.unit=b.unit,void 0===b.type?this.type="n":this.type=b.type,void 0===b.delay?this.delay=0:this.delay=b.delay,void 0===b.duration?this.duration=1e3:this.duration=b.duration,void 0===b.callback|"function"!=typeof b.callback?this.callback=null:this.callback=b.callback,void 0===b.order?this.order=1:this.order=b.order):(this.unit="c",this.type="n",this.delay=0,this.duration=1e3,this.callback=null,this.order=1),this.text=this.getCharacters(),this.reversedText=this.getCharacters().reverse(),this.count=this.getCounts(),this.next=null}function Speller(a){a?this.container=a:this.container=document.body,this.animatexts=this.getAnimatexts(),this.sortedAnimatexts=this.sortAnimatexts(this.animatexts)}AnimaText.prototype.setUnit=function(a){return this.unit=a,this},AnimaText.prototype.setType=function(a){return this.type=a,this},AnimaText.prototype.setDelay=function(a){return this.delay=a,this},AnimaText.prototype.setDuration=function(a){return this.duration=a,this},AnimaText.prototype.setCallback=function(a){return this.callback=a,this},AnimaText.prototype.getTextNodes=function(){var a=[],b=function(c){for(var d=0;d<c.childNodes.length;d++)if(3==c.childNodes[d].nodeType){var e={};e.parent=c.childNodes[d].parentNode,e.index=d,e.value=c.childNodes[d].nodeValue.split(""),a.push(e)}else b(c.childNodes[d]);return a};return b(this.element)},AnimaText.prototype.getCharacters=function(){for(var a=this.getTextNodes(),b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].value.length;d++){var e={};e.value=a[c].value[d],e.element=a[c].parent,e.nodeIndex=a[c].index,b.push(e)}return b},AnimaText.prototype.getCounts=function(){for(var a=this.getTextNodes(),b={},c=[],d=0;d<a.length;d++)c=c.concat(a[d].value);b.characters=c.length,b.characters=c.length;var e=c.toString(),f=e.match(/ |\u00A0/g);f?b.words=f.length+1:b.words=1;var g=e.match(/\u002E|\u2026|\u003F|\u0021/g);return g?b.sentences=g.length:b.sentences=1,b},AnimaText.prototype.setSize=function(){var a=this.element,b=window.getComputedStyle(a);"inline"!==b.display&&(a.style.width=a.clientWidth+"px",a.style.height=a.clientHeight+"px","0px"!==b.marginTop&&(a.style.marginTop=b.marginTop),"0px"!==b.marginBottom&&(a.style.marginBottom=b.marginBottom))},AnimaText.prototype.emptyNodes=function(){this.setSize();for(var a=this.getTextNodes(),b=0;b<a.length;b++)a[b].parent.childNodes[a[b].index].nodeValue=""},AnimaText.prototype.spellCharacters=function(){function a(){i.style.visibility="visible",k=window.setInterval(function(){b()},l)}function b(){1==s?c():d()}function c(){var a;q>=0?(a=p[q],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,q-=1,s=!1):(window.clearInterval(k),n&&n(),o&&o())}function d(){var a;r<=p.length-1?(a=p[r],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,r+=1,s=!0):(window.clearInterval(k),n&&n(),o&&o())}function e(){i.style.visibility="visible",k=window.setInterval(function(){f()},l)}function f(){var a;t<=p.length-1?(a=p[t],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,t+=1):(window.clearInterval(k),n&&n(),o&&o())}function g(){i.style.visibility="visible",k=window.setInterval(function(){h()},l)}function h(){var a;t<=p.length-1?(a=p[t],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,t+=1):(window.clearInterval(k),n&&n(),o&&o())}this.emptyNodes();var i=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var j=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var k,l=this.duration/this.count.characters,m=this.type,n=this.callback,o=this.next;if("m"==m){var p=this.text,q=Math.ceil(p.length/2)-1,r=q+1,s=!0;window.setTimeout(function(){a()},j)}else if("r"==m){var t=0,p=this.reversedText;window.setTimeout(function(){e()},j)}else{if("n"!=m)throw new TypeError("Invalid AnimaText() argument : if unit = c, type must be n, r, or m");var p=this.text,t=0;window.setTimeout(function(){g()},j)}},AnimaText.prototype.spellWords=function(){function a(){e.style.visibility="visible",g=window.setInterval(function(){b()},h)}function b(){var a;do{if(!(l<=m.length-1)){window.clearInterval(g),j&&j(),k&&k();break}a=m[l],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,l+=1}while(" "!=a.value&&" "!=a.value)}function c(){e.style.visibility="visible",g=window.setInterval(function(){d()},h)}function d(){var a;do{if(!(l<=m.length-1)){window.clearInterval(g),j&&j(),k&&k();break}a=m[l],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,l+=1}while(" "!=a.value&&" "!=a.value)}this.emptyNodes();var e=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var f=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var g,h=this.duration/this.count.words,i=this.type,j=this.callback,k=this.next;if("r"==i){var l=0,m=this.reversedText;window.setTimeout(function(){a()},f)}else{if("n"!=i)throw new TypeError("Invalid AnimaText() argument : if unit = w, type must be n or r");var m=this.text,l=0;window.setTimeout(function(){c()},f)}},AnimaText.prototype.spellSentences=function(){function a(){c.style.visibility="visible",e=window.setInterval(function(){b()},f)}function b(){var a;do{if(!(j<=i.length-1)){window.clearInterval(e),g&&g(),h&&h();break}a=i[j],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,j+=1}while("."!=a.value&&"…"!=a.value&&"?"!=a.value&&"!"!=a.value)}this.emptyNodes();var c=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var d=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var e,f=this.duration/this.count.sentences,g=(this.type,this.callback),h=this.next,i=this.text,j=0;window.setTimeout(function(){a()},d)},AnimaText.prototype.spellAll=function(){this.setSize();var a=this.element;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");this.duration;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var b=this.delay+this.duration,c=this.callback,d=this.next;a.style.visibility="hidden",window.setTimeout(function(){a.style.visibility="visible",c&&c(),d&&d()},b)},AnimaText.prototype.spell=function(){if("c"==this.unit)return this.spellCharacters();if("w"==this.unit)return this.spellWords();if("s"==this.unit)return this.spellSentences();if("a"==this.unit)return this.spellAll();throw new TypeError("Invalid AnimaText() argument : unit must be c, w, s or a")},AnimaText.prototype.unspellCharacters=function(){function a(){f.style.visibility="visible",h=window.setInterval(function(){b()},i)}function b(){if(m<=e.length-1){var a=e[m],b=a.parent,c=a.index;a.nodeValue;b.childNodes[c].nodeValue.length>0?b.childNodes[c].nodeValue=b.childNodes[c].nodeValue.slice(1,b.childNodes[c].nodeValue.length):m+=1}else window.clearInterval(h),k&&k(),l&&l()}function c(){f.style.visibility="visible",h=window.setInterval(function(){d()},i)}function d(){if(m>=0){var a=e[m],b=a.parent,c=a.index;a.nodeValue;b.childNodes[c].nodeValue.length>0?b.childNodes[c].nodeValue=b.childNodes[c].nodeValue.slice(0,-1):m-=1}else window.clearInterval(h),k&&k(),l&&l()}this.setSize();var e=this.getTextNodes().slice(0),f=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var g=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var h,i=this.duration/this.count.characters,j=this.type,k=this.callback,l=this.next;if("r"==j){var m=0;window.setTimeout(function(){a()},g)}else{if("n"!=j)throw new TypeError("Invalid AnimaText() argument : type must be n, r or m");var m=e.length-1;e[m];window.setTimeout(function(){c()},g)}},AnimaText.prototype.unspellWords=function(){function a(){d.style.visibility="visible",f=window.setInterval(function(){b()},g)}function b(){if(j>=0){var a,b=c[j],d=b.parent,e=b.index;b.nodeValue;do{if(!(b.value.length>0)){j-=1;break}d.childNodes[e].nodeValue=d.childNodes[e].nodeValue.slice(0,-1),a=b.value.splice(-1,1)}while(" "!=a&&" "!=a.value)}else window.clearInterval(f),h&&h(),i&&i()}this.setSize();var c=this.getTextNodes().slice(0),d=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var e=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var f,g=this.duration/this.count.words,h=(this.type,this.callback),i=this.next,j=c.length-1;c[j];window.setTimeout(function(){a()},e)},AnimaText.prototype.unspell=function(){if("c"==this.unit)return this.unspellCharacters();if("w"==this.unit)return this.unspellWords();throw new TypeError("Invalid AnimaText() argument : unit must be c or w")},Speller.prototype.getAnimatexts=function(){this.elements=this.container.querySelectorAll("[data-animatext]");for(var array=[],i=0;i<this.elements.length;i++){var animatext={};animatext.options=eval(this.elements[i].getAttribute("data-animatext")),animatext.text=new AnimaText(this.elements[i],animatext.options),"unspell"!=animatext.options.action&&"a"!=animatext.text.unit&&animatext.text.emptyNodes(),array.push(animatext)}return array},Speller.prototype.sortAnimatexts=function(a){var b=[],c=0;for(d=0;d<a.length;d++)c=a[d].options.order>c?a[d].options.order:c;for(var d=0;c>d;){for(var e=[],f=0;f<a.length;f++)a[f].options.order==d+1&&e.push(a[f]);e.length>0&&b.push(e),d++}return b},Speller.prototype.longest=function(a){var b=a[0].text;if(a.length>1)for(var c=1;c<a.length;c++)a[c].text.duration+a[c].text.delay>b.duration+b.delay&&(b=a[c].text);return b},Speller.prototype.launch=function(a){var b=this;if(a[0]){var c=a[0],d=this.longest(c);d.next=function(){b.launch(a)};for(var e=0;e<c.length;e++)if("spell"==c[e].options.action)c[e].text.spell();else{if("unspell"!=c[e].options.action)throw new TypeError("Invalid speller argument : action must be spell or unspell");c[e].text.unspell()}a.splice(0,1)}},Speller.prototype.start=function(){this.queue=this.sortedAnimatexts.slice(0),this.launch(this.queue)};