"use strict";function AnimaText(a,b){if(void 0===a)throw new TypeError("Invalid AnimaText() argument : element must be defined");if(!a.tagName)throw new TypeError("Invalid AnimaText() argument : element must be HTML element");this.element=a,this.element.innerHTML=this.element.innerHTML.replace(/^\s*|\s(?=\s)|\s*$/g,""),void 0!==b?(void 0===b.unit?this.unit="c":this.unit=b.unit,void 0===b.type?this.type="n":this.type=b.type,void 0===b.delay?this.delay=0:this.delay=b.delay,void 0===b.duration?this.duration=1e3:this.duration=b.duration,void 0===b.callback|"function"!=typeof b.callback?this.callback=null:this.callback=b.callback,void 0===b.order?this.order=1:this.order=b.order,void 0===b.action?this.action=null:this.action=b.action,void 0===b.freezeSize?this.freezeSize=!0:this.freezeSize=b.freezeSize):(this.unit="c",this.type="n",this.delay=0,this.duration=1e3,this.callback=null,this.order=1,this.action=null,this.freezeSize=!0),this.text=this.getCharacters(),this.reversedText=this.getCharacters().reverse(),this.count=this.getCounts(),this.next=null}function Speller(a){a?this.container=a:this.container=document.body,this.animatexts=this.getAnimatexts(),this.sortedAnimatexts=this.sortAnimatexts(this.animatexts)}AnimaText.prototype.setUnit=function(a){return this.unit=a,this},AnimaText.prototype.setType=function(a){return this.type=a,this},AnimaText.prototype.setDelay=function(a){return this.delay=a,this},AnimaText.prototype.setDuration=function(a){return this.duration=a,this},AnimaText.prototype.setCallback=function(a){return this.callback=a,this},AnimaText.prototype.setFreezeSize=function(a){return this.freezeSize=a,this},AnimaText.prototype.getTextNodes=function(){var a=[],b=function(c){for(var d=0;d<c.childNodes.length;d++)if(3==c.childNodes[d].nodeType){var e={};e.parent=c.childNodes[d].parentNode,e.index=d,e.value=c.childNodes[d].nodeValue.split(""),a.push(e)}else b(c.childNodes[d]);return a};return b(this.element)},AnimaText.prototype.getCharacters=function(){for(var a=this.getTextNodes(),b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].value.length;d++){var e={};e.value=a[c].value[d],e.element=a[c].parent,e.nodeIndex=a[c].index,b.push(e)}return b},AnimaText.prototype.getCounts=function(){for(var a=this.getTextNodes(),b={},c=[],d=0;d<a.length;d++)c=c.concat(a[d].value);b.characters=c.length,b.characters=c.length;var e=c.toString(),f=e.match(/ |\u00A0/g);f?b.words=f.length+1:b.words=1;var g=e.match(/\u002E|\u2026|\u003F|\u0021/g);return g?b.sentences=g.length:b.sentences=1,b},AnimaText.prototype.setSize=function(){var a=this.element,b=window.getComputedStyle(a);"inline"!==b.display&&(a.style.width=a.clientWidth+"px",a.style.height=a.clientHeight+"px","0px"!==b.marginTop&&(a.style.marginTop=b.marginTop),"0px"!==b.marginBottom&&(a.style.marginBottom=b.marginBottom))},AnimaText.prototype.emptyNodes=function(){this.freezeSize===!0&&this.setSize();for(var a=this.getTextNodes(),b=0;b<a.length;b++)a[b].parent.childNodes[a[b].index].nodeValue=""},AnimaText.prototype.spellCharacters=function(){if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var a=this.duration/this.count.characters;if(this.emptyNodes(),this.element.style.visibility="visible","n"==this.type){this._index=0;var b=this;this.interval=window.setInterval(function(){b.spellCharactersN.call(b)},a)}else if("r"==this.type){this._index=0;var b=this;this.interval=window.setInterval(function(){b.spellCharactersR.call(b)},a)}else if("m"==this.type){this._index1=Math.ceil(this.text.length/2)-1,this._index2=Math.ceil(this.text.length/2),this._flag=!0;var b=this;this.interval=window.setInterval(function(){b.spellCharactersM.call(b)},a)}else{if("e"!=this.type)throw new TypeError("Invalid AnimaText() argument : if unit = c, type must be n, r, m or e");this._index1=0,this._index2=this.text.length-1,this._middle=Math.ceil(this.text.length/2)-1,this._array1=[],this._array2=[],this._flag=!0;var b=this;this.interval=window.setInterval(function(){b.spellCharactersE.call(b)},a)}},AnimaText.prototype.spellCharactersN=function(){var a;this._index<=this.text.length-1?(a=this.text[this._index],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,this._index+=1):(window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next())},AnimaText.prototype.spellCharactersR=function(){var a;this._index<=this.reversedText.length-1?(a=this.reversedText[this._index],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,this._index+=1):(window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next())},AnimaText.prototype.spellCharactersM=function(){if(1==this._flag){var a;this._index1>=0?(a=this.text[this._index1],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,this._index1-=1,this._flag=!1):(window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next())}else{var b;this._index2<=this.text.length-1?(b=this.text[this._index2],b.element.childNodes[b.nodeIndex].nodeValue+=b.value,this._index2+=1,this._flag=!0):(window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next())}},AnimaText.prototype.spellCharactersE=function(){var a=[];if(1==this._flag){var b;if(this._index1<=this._middle){b=this.text[this._index1],this._array1.push(b),a=this._array1.concat(this._array2);for(var c=0;c<a.length;c++)a[c].element.childNodes[a[c].nodeIndex].nodeValue="";for(var c=0;c<a.length;c++)a[c].element.childNodes[a[c].nodeIndex].nodeValue+=a[c].value;this._index1+=1,this._flag=!1}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()}else{var d;if(this._index2>this._middle){d=this.text[this._index2],this._array2.unshift(d),a=this._array1.concat(this._array2);for(var c=0;c<a.length;c++)a[c].element.childNodes[a[c].nodeIndex].nodeValue="";for(var c=0;c<a.length;c++)a[c].element.childNodes[a[c].nodeIndex].nodeValue+=a[c].value;this._index2-=1,this._flag=!0}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()}},AnimaText.prototype.spellWords=function(){if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var a=this.duration/this.count.words;if(this.emptyNodes(),this.element.style.visibility="visible","n"==this.type){this.index=0;var b=this;this.interval=window.setInterval(function(){b.spellWordsN.call(b)},a)}else{if("r"!=this.type)throw new TypeError("Invalid AnimaText() argument : if unit = w, type must be n or r");this.index=0;var b=this;this.interval=window.setInterval(function(){b.spellWordsR.call(b)},a)}},AnimaText.prototype.spellWordsN=function(){var a;do{if(!(this.index<=this.text.length-1)){window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next();break}a=this.text[this.index],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,this.index+=1}while(" "!=a.value&&" "!=a.value)},AnimaText.prototype.spellWordsR=function(){var a;do{if(!(this.index<=this.reversedText.length-1)){window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next();break}a=this.reversedText[this.index],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,this.index+=1}while(" "!=a.value&&" "!=a.value)},AnimaText.prototype.spellSentences=function(){if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var a=this.duration/this.count.sentences;if(this.emptyNodes(),this.element.style.visibility="visible","n"!=this.type)throw new TypeError("Invalid AnimaText() argument : if unit = s, type must be n");this.index=0;var b=this;this.interval=window.setInterval(function(){b.spellSentencesN.call(b)},a)},AnimaText.prototype.spellSentencesN=function(){var a;do{if(!(this.index<=this.text.length-1)){window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next();break}a=this.text[this.index],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,this.index+=1}while("."!=a.value&&"…"!=a.value&&"?"!=a.value&&"!"!=a.value)},AnimaText.prototype.spellAll=function(){this.element.style.visibility="hidden";var a=this;window.setTimeout(function(){a.element.style.visibility="visible",a.callback&&a.callback(),a.next&&a.next()},a.delay)},AnimaText.prototype.spell=function(){if(this.action="spell","number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");this.delay;if("c"==this.unit){var a=this;window.setTimeout(function(){a.spellCharacters()},a.delay)}else if("w"==this.unit){var a=this;window.setTimeout(function(){a.spellWords()},a.delay)}else{if("s"!=this.unit){if("a"==this.unit)return this.spellAll();throw new TypeError("Invalid AnimaText() argument : unit must be c, w, s or a")}var a=this;window.setTimeout(function(){a.spellSentences()},a.delay)}},AnimaText.prototype.unspellCharacters=function(){if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var a=this.duration/this.count.characters;if(this.freezeSize===!0&&this.setSize(),this.element.style.visibility="visible","n"==this.type){this._array=this.getTextNodes().slice(0),this._index=this._array.length-1;var b=this;this.interval=window.setInterval(function(){b.unspellCharactersN.call(b)},a)}else if("r"==this.type){this._array=this.getTextNodes().slice(0),this._index=0;var b=this;this.interval=window.setInterval(function(){b.unspellCharactersR.call(b)},a)}else if("m"==this.type){var c=Math.ceil(this.text.length/2);this._array=[],this._array1=this.text.slice(0,c),this._array2=this.text.slice(c),this._flag=!0;var b=this;this.interval=window.setInterval(function(){b.unspellCharactersM.call(b)},a)}else{if("e"!=this.type)throw new TypeError("Invalid AnimaText() argument : if unit = c, type must be n, r, m or e");var c=Math.ceil(this.text.length/2);this._array=[],this._array1=this.text.slice(0,c),this._array2=this.text.slice(c),this._flag=!0;var b=this;this.interval=window.setInterval(function(){b.unspellCharactersE.call(b)},a)}},AnimaText.prototype.unspellCharactersN=function(){if(this._index>=0){var a=this._array[this._index],b=a.parent,c=a.index;a.nodeValue;b.childNodes[c].nodeValue.length>0?b.childNodes[c].nodeValue=b.childNodes[c].nodeValue.slice(0,-1):this._index-=1}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()},AnimaText.prototype.unspellCharactersR=function(){if(this._index<=this._array.length-1){var a=this._array[this._index],b=a.parent,c=a.index;a.nodeValue;b.childNodes[c].nodeValue.length>0?b.childNodes[c].nodeValue=b.childNodes[c].nodeValue.slice(1,b.childNodes[c].nodeValue.length):this._index+=1}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()},AnimaText.prototype.unspellCharactersM=function(){if(1==this._flag)if(void 0!==this._array1.shift()){this.emptyNodes(),this._array=this._array1.concat(this._array2);for(var a=0;a<this._array.length;a++)this._array[a].element.childNodes[this._array[a].nodeIndex].nodeValue+=this._array[a].value;this._flag=!1}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next();else if(void 0!==this._array2.pop()){this.emptyNodes(),this._array=this._array1.concat(this._array2);for(var a=0;a<this._array.length;a++)this._array[a].element.childNodes[this._array[a].nodeIndex].nodeValue+=this._array[a].value;this._flag=!0}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()},AnimaText.prototype.unspellCharactersE=function(){if(1==this._flag)if(void 0!==this._array1.pop()){this.emptyNodes(),this._array=this._array1.concat(this._array2);for(var a=0;a<this._array.length;a++)this._array[a].element.childNodes[this._array[a].nodeIndex].nodeValue+=this._array[a].value;this._flag=!1}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next();else if(void 0!==this._array2.shift()){this.emptyNodes(),this._array=this._array1.concat(this._array2);for(var a=0;a<this._array.length;a++)this._array[a].element.childNodes[this._array[a].nodeIndex].nodeValue+=this._array[a].value;this._flag=!0}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()},AnimaText.prototype.unspellWords=function(){if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var a=this.duration/this.count.words;if(this.freezeSize===!0&&this.setSize(),this.element.style.visibility="visible","n"!=this.type)throw new TypeError("Invalid AnimaText() argument : if unit = w, type must be n or r");this._array=this.getTextNodes().slice(0),this._index=this._array.length-1;var b=this;this.interval=window.setInterval(function(){b.unspellWordsN.call(b)},a)},AnimaText.prototype.unspellWordsN=function(){if(this._index>=0){var a,b=this._array[this._index],c=b.parent,d=b.index;b.nodeValue;do{if(!(b.value.length>0)){this._index-=1;break}c.childNodes[d].nodeValue=c.childNodes[d].nodeValue.slice(0,-1),a=b.value.splice(-1,1)}while(" "!=a&&" "!=a.value)}else window.clearInterval(this.interval),this.callback&&this.callback(),this.next&&this.next()},AnimaText.prototype.unspell=function(){if(this.action="unspell","number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");this.delay;if("c"==this.unit){var a=this;window.setTimeout(function(){a.unspellCharacters()},a.delay)}else{if("w"!=this.unit)throw new TypeError("Invalid AnimaText() argument : unit must be c or w");var a=this;window.setTimeout(function(){a.unspellWords()},a.delay)}},AnimaText.prototype.stop=function(){if(window.clearInterval(this.interval),"spell"==this.action)"c"==this.unit?0==this.type?this._index=0:"m"==this.type?(this._index1=Math.ceil(this.text.length/2)-1,this._index2=Math.ceil(this.text.length/2),this._flag=!0):"e"==this.type&&(this._index1=0,this._index2=this.text.length-1,this._middle=Math.ceil(this.text.length/2)-1,this._array1=[],this._array2=[],this._flag=!0):"w"==this.unit?0==this.type&&(this._index=0):"s"==this.unit&&"n"==this.type&&(this._index=0);else if("unspell"==this.action&&"c"==this.unit)if("n"==this.type)this._array=this.getTextNodes().slice(0),this._index=this.array.length-1;else if("r"==this.type)this._array=this.getTextNodes().slice(0),this._index=0;else if("m"==this.type){var a=Math.ceil(this.text.length/2);this._array=[],this._array1=this.text.slice(0,a),this._array2=this.text.slice(a),this._flag=!0}else if("e"==this.type){var a=Math.ceil(this.text.length/2);this._array=[],this._array1=this.text.slice(0,a),this._array2=this.text.slice(a),this._flag=!0}},AnimaText.prototype.pause=function(){window.clearInterval(this.interval)},AnimaText.prototype.resume=function(){var a=this;if("spell"==this.action){if("c"==this.unit){var b=this.duration/this.count.characters;"n"==this.type?this.interval=window.setInterval(function(){a.spellCharactersN.call(a)},b):"r"==this.type?this.interval=window.setInterval(function(){a.spellCharactersR.call(a)},b):"m"===this.type?this.interval=window.setInterval(function(){a.spellCharactersM.call(a)},b):"e"===this.type&&(this.interval=window.setInterval(function(){a.spellCharactersE.call(a)},b))}else if("w"==this.unit){var b=this.duration/this.count.words;"n"==this.type?this.interval=window.setInterval(function(){a.spellWordsN.call(a)},b):"r"==this.type&&(this.interval=window.setInterval(function(){a.spellWordsR.call(a)},b))}else if("s"==this.unit){var b=this.duration/this.count.sentences;"n"==this.type&&(this.interval=window.setInterval(function(){a.spellSentencesN.call(a)},b))}}else if("unspell"==this.action&&"c"==this.unit){var b=this.duration/this.count.characters;"n"==this.type?this.interval=window.setInterval(function(){a.unspellCharactersN.call(a)},b):"r"==this.type?this.interval=window.setInterval(function(){a.unspellCharactersR.call(a)},b):"m"===this.type?this.interval=window.setInterval(function(){a.unspellCharactersM.call(a)},b):"e"===this.type&&(this.interval=window.setInterval(function(){a.unspellCharactersE.call(a)},b))}},AnimaText.prototype.unspellWords=function(){function a(){d.style.visibility="visible",f=window.setInterval(function(){b()},g)}function b(){if(j>=0){var a,b=c[j],d=b.parent,e=b.index;b.nodeValue;do{if(!(b.value.length>0)){j-=1;break}d.childNodes[e].nodeValue=d.childNodes[e].nodeValue.slice(0,-1),a=b.value.splice(-1,1)}while(" "!=a&&" "!=a.value)}else window.clearInterval(f),h&&h(),i&&i()}this.freezeSize===!0&&this.setSize();var c=this.getTextNodes().slice(0),d=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var e=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var f,g=this.duration/this.count.words,h=(this.type,this.callback),i=this.next,j=c.length-1;c[j];window.setTimeout(function(){a()},e)},Speller.prototype.getAnimatexts=function(){this.elements=this.container.querySelectorAll("[data-animatext]");for(var array=[],i=0;i<this.elements.length;i++){var animatext=new AnimaText(this.elements[i],eval(this.elements[i].getAttribute("data-animatext")));"unspell"!=animatext.action&&"a"!=animatext.unit&&animatext.emptyNodes(),array.push(animatext)}return array},Speller.prototype.sortAnimatexts=function(a){var b=[],c=0;for(d=0;d<a.length;d++)c=a[d].order>c?a[d].order:c;for(var d=0;c>d;){for(var e=[],f=0;f<a.length;f++)a[f].order==d+1&&e.push(a[f]);e.length>0&&b.push(e),d++}return b},Speller.prototype.longest=function(a){var b=a[0];if(a.length>1)for(var c=1;c<a.length;c++)a[c].duration+a[c].delay>b.duration+b.delay&&(b=a[c]);return b},Speller.prototype.launch=function(a){var b=this;if(a[0]){var c=a[0],d=this.longest(c);d.next=function(){b.launch(a)};for(var e=0;e<c.length;e++)if("spell"==c[e].action)c[e].spell();else{if("unspell"!=c[e].action)throw new TypeError("Invalid speller argument : action must be spell or unspell");c[e].unspell()}a.splice(0,1)}},Speller.prototype.start=function(){this.queue=this.sortedAnimatexts.slice(0),this.launch(this.queue)};