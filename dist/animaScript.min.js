"use strict";function AnimaText(a,b){if(void 0===a)throw new TypeError("Invalid AnimaText() argument : element must be defined");if(!a.tagName)throw new TypeError("Invalid AnimaText() argument : element must be HTML element");this.element=a,void 0!==b?(void 0===b.unit?this.unit="c":this.unit=b.unit,void 0===b.type?this.type="n":this.type=b.type,void 0===b.delay?this.delay=250:this.delay=b.delay,void 0===b.duration?this.duration=1e3:this.duration=b.duration,void 0===b.callback|"function"!=typeof b.callback?this.callback=null:this.callback=b.callback,void 0===b.order?this.order=1:this.order=b.order):(this.unit="c",this.type="n",this.delay=250,this.duration=1e3,this.callback=null,this.order=1),this.text=this.getCharacters(),this.reversedText=this.getCharacters().reverse(),this.count=this.getCounts(),this.charactersCount=this.count.characters,this.wordsCount=this.count.words,this.sentencesCount=this.count.sentences,this.next=null}AnimaText.prototype.setUnit=function(a){return this.unit=a,this},AnimaText.prototype.setType=function(a){return this.type=a,this},AnimaText.prototype.setDelay=function(a){return this.delay=a,this},AnimaText.prototype.setDuration=function(a){return this.duration=a,this},AnimaText.prototype.setCallback=function(a){return this.callback=a,this},AnimaText.prototype.getTextNodes=function(){var a=[],b=function(c){for(var d=0;d<c.childNodes.length;d++)if(3==c.childNodes[d].nodeType){var e={};e.parent=c.childNodes[d].parentNode,e.nodeIndex=d,e.value=c.childNodes[d].nodeValue.split(""),a.push(e)}else b(c.childNodes[d]);return a};return b(this.element)},AnimaText.prototype.getCharacters=function(){for(var a=this.getTextNodes(),b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].value.length;d++){var e={};e.value=a[c].value[d],e.element=a[c].parent,e.nodeIndex=a[c].nodeIndex,b.push(e)}return b},AnimaText.prototype.getCounts=function(){for(var a=this.getTextNodes(),b={},c=[],d=0;d<a.length;d++)c=c.concat(a[d].value);c?b.characters=c.length:b.characters=1,b.characters=c.length;var e=c.toString(),f=e.match(/ |\u00A0/g);f?b.words=f.length+1:b.words=1;var g=e.match(/\u002E|\u2026/g);return g?b.sentences=g.length:b.sentences=1,b},AnimaText.prototype.emptyNodes=function(){var a=this.element,b=this.getTextNodes(),c=window.getComputedStyle(a);"inline"!==c.display&&(a.style.width=a.clientWidth+"px",a.style.height=a.clientHeight+"px","0px"!==c.marginTop&&(a.style.marginTop=c.marginTop),"0px"!==c.marginBottom&&(a.style.marginBottom=c.marginBottom)),a.style.visibility="hidden";for(var d=0;d<b.length;d++)b[d].parent.childNodes[b[d].nodeIndex].nodeValue=""},AnimaText.prototype.spellCharacters=function(){function a(){i.style.visibility="visible",k=window.setInterval(function(){b()},l)}function b(){1==s?c():d()}function c(){var a;q>=0?(a=p[q],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,q-=1,s=!1):(window.clearInterval(k),n&&n(),o&&o())}function d(){var a;r<=p.length-1?(a=p[r],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,r+=1,s=!0):(window.clearInterval(k),n&&n(),o&&o())}function e(){i.style.visibility="visible",k=window.setInterval(function(){f()},l)}function f(){var a;q<=p.length-1?(a=p[q],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,q+=1):(window.clearInterval(k),n&&n(),o&&o())}function g(){i.style.visibility="visible",k=window.setInterval(function(){h()},l)}function h(){var a;q<=p.length-1?(a=p[q],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,q+=1):(window.clearInterval(k),n&&n(),o&&o())}this.emptyNodes();var i=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var j=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var k,l=this.duration/this.count.characters,m=this.type,n=this.callback,o=this.next;if("m"==m){var p=this.text,q=Math.ceil(p.length/2)-1,r=q+1,s=!0;window.setTimeout(function(){a()},j)}else if("r"==m){var q=0,p=this.reversedText;window.setTimeout(function(){e()},j)}else{if("n"!=m)throw new TypeError("Invalid AnimaText() argument : type must be n, r or m");var p=this.text,q=0;window.setTimeout(function(){g()},j)}},AnimaText.prototype.spellWords=function(){function a(){i.style.visibility="visible",k=window.setInterval(function(){b()},l)}function b(){1==s?c():d()}function c(){var a;do{if(!(q>=0)){window.clearInterval(k),n&&n(),o&&o();break}a=p[q],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,q-=1,s=!1}while(" "!=a.value&&" "!=a.value)}function d(){var a;do{if(!(r<=p.length-1)){window.clearInterval(k),n&&n(),o&&o();break}a=p[r],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,r+=1,s=!0}while(" "!=a.value&&" "!=a.value)}function e(){i.style.visibility="visible",k=window.setInterval(function(){f()},l)}function f(){var a;do{if(!(q<=p.length-1)){window.clearInterval(k),n&&n(),o&&o();break}a=p[q],a.element.childNodes[a.nodeIndex].nodeValue=a.value+a.element.childNodes[a.nodeIndex].nodeValue,q+=1}while(" "!=a.value&&" "!=a.value)}function g(){i.style.visibility="visible",k=window.setInterval(function(){h()},l)}function h(){var a;do{if(!(q<=p.length-1)){window.clearInterval(k),n&&n(),o&&o();break}a=p[q],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,q+=1}while(" "!=a.value&&" "!=a.value)}this.emptyNodes();var i=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var j=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var k,l=this.duration/this.count.words,m=this.type,n=this.callback,o=this.next;if("m"==m){var p=this.text,q=Math.ceil(p.length/2)-1,r=q+1,s=!0;window.setTimeout(function(){a()},j)}else if("r"==m){var q=0,p=this.reversedText;window.setTimeout(function(){e()},j)}else{if("n"!=m)throw new TypeError("Invalid AnimaText() argument : type must be n, r or m");var p=this.text,q=0;window.setTimeout(function(){g()},j)}},AnimaText.prototype.spellSentences=function(){function a(){c.style.visibility="visible",e=window.setInterval(function(){b()},f)}function b(){var a;do{if(!(j<=i.length-1)){window.clearInterval(e),g&&g(),h&&h();break}a=i[j],a.element.childNodes[a.nodeIndex].nodeValue+=a.value,j+=1}while("."!=a.value&&"…"!=a.value)}this.emptyNodes();var c=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var d=this.delay;if("number"!=typeof this.duration)throw new TypeError("Invalid AnimaText() argument : duration must be a number");var e,f=this.duration/this.count.sentences,g=(this.type,this.callback),h=this.next,i=this.text,j=0;window.setTimeout(function(){a()},d)},AnimaText.prototype.spellAll=function(){var a=this.element;if("number"!=typeof this.delay)throw new TypeError("Invalid AnimaText() argument : delay must be a number");var b=this.delay,c=this.callback,d=this.next;a.style.visibility="hidden",window.setTimeout(function(){a.style.visibility="visible",c&&c(),d&&d()},b)},AnimaText.prototype.spell=function(){if("c"==this.unit)return this.spellCharacters();if("w"==this.unit)return this.spellWords();if("s"==this.unit)return this.spellSentences();if("a"==this.unit)return this.spellAll();throw new TypeError("Invalid AnimaText() argument : unit must be c, w, s or a")};var speller={getAnimatexts:function(){this.elements=this.container.querySelectorAll("[data-animatext]");for(var array=[],i=0;i<this.elements.length;i++){var animatext={};animatext.options=eval(this.elements[i].getAttribute("data-animatext")),animatext.text=new AnimaText(this.elements[i],animatext.options),animatext.text.emptyNodes(),array.push(animatext)}return array},sortAnimatexts:function(a){var b=[],c=0;for(d=0;d<a.length;d++)c=a[d].options.order>c?a[d].options.order:c;for(var d=0;c>d;){for(var e=[],f=0;f<a.length;f++)a[f].options.order==d+1&&e.push(a[f]);e.length>0&&b.push(e),d++}return b},longest:function(a){var b=a[0].text;if(a.length>1)for(var c=1;c<a.length;c++)a[c].text.duration+a[c].text.delay>b.duration+b.delay&&(b=a[c].text);return b},launch:function(a){if(a[0]){var b=a[0],c=this.longest(b);c.next=function(){speller.launch(a)};for(var d=0;d<b.length;d++){if("spell"!=b[d].options.action)throw new TypeError("Invalid speller argument : action must be spell");b[d].text.spell()}a.splice(0,1)}},spell:function(a){a?this.container=a:this.container=document.body,this.animatexts=this.getAnimatexts(),this.sortedAnimatexts=this.sortAnimatexts(this.animatexts),this.queue=this.sortedAnimatexts.slice(0),this.launch(this.queue)}};